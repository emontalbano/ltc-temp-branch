<ion-header>
    <ion-navbar color="primary">
      <button ion-button icon-only menuToggle>
        <ion-icon name="menu"></ion-icon>
      </button>
      <ion-title>View Invoice</ion-title>
    </ion-navbar>
    <jh-nav-pending></jh-nav-pending>
  </ion-header>
  <ion-content *ngIf="meta | async as meta$" [ngClass]="(meta$.pending) ? 'loading' :  'standard'">
    <div class="standardView" *ngIf="!hasInvoices">
      <h4>No invoices to show</h4>
    </div>
    <div class="standardView invoiceHistory" *ngIf="hasInvoices">
      <div class="customer">
        <span>Customer</span>
        <div>{{ contact.associated_policy__r.insured__r.name }}  </div>
      </div>
      <mat-card>
        <mat-card-title>
            <span>Invoice Status</span>
            <h6>{{ (invoice.ltc_cast_iron_pull_status__c === 'New') ? 'Not Submitted' : 
                (invoice.ltc_cast_iron_pull_status__c === 'Scanned - Ready for Document Processing' 
                 || invoice.ltc_cast_iron_pull_status__c === 'SmartCorrespond Call Error') ? 'Pending' : 
                 (invoice.ltc_cast_iron_pull_status__c === 'Ready to be Pulled' 
                 || invoice.ltc_cast_iron_pull_status__c === 'Pulled') ? 'Submitted' 
                 : 'Not Submitted' }}</h6>
          </mat-card-title>
        <mat-card-content>
            <mat-table #table [dataSource]="checkins_ds">
                <ng-container matColumnDef="date">
                  <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
                  <mat-cell *matCellDef="let item">
                    <div *ngIf="item.ltc_check_out_datetime__c !== null" class="flex">
                      <div *ngIf="submittingInvoice">
                        <mat-checkbox [(ngModel)]="invoiceMap[item.id]"></mat-checkbox>
                      </div>
                      <mat-icon>location_off</mat-icon>
                      <div>
                        {{ item.ltc_check_in_datetime__c | date: 'shortDate'}}
                        <span class="subtext">{{ item.ltc_check_in_datetime__c | date: 'shortTime' }} &ndash; {{ item.checkout  | date: 'shortTime' }}</span>
                      </div>
                    </div>
                    <div *ngIf="item.ltc_check_out_datetime__c === null" class="flex">
                        <mat-icon>location_ff</mat-icon>
                        <div>
                          {{ item.ltc_check_in_datetime__c | date: 'shortTime' }}
                          <span class="subtext">{{ item.ltc_check_in_datetime__c | date: 'shortDate'}}</span>
                        </div>
                    </div>
                  </mat-cell>
                </ng-container>
                <ng-container matColumnDef="billing">
                  <mat-header-cell *matHeaderCellDef>Billed</mat-header-cell>
                  <mat-cell *matCellDef="let item"> 
                      <span *ngIf="item.ltc_check_out_datetime__c !== null">

                        ${{ item.ltc_check_in_datetime__c | rateFormat:item.ltc_check_out_datetime__c:item.ltc_hourly_rate__c }}
                        <span class="subtext">{{ item.ltc_check_in_datetime__c | timeEst:item.checkout:true }}h &times; ${{ item.ltc_hourly_rate__c }}/h</span>
                      </span>
                      <div *ngIf="item.ltc_check_out_datetime__c === null" class="flex right">
                        <button mat-icon-button color="white" (click)="checkout(item)"><mat-icon>stop</mat-icon></button>
                        <div *ngIf="endTime | async as $endTime">
                            {{ item.ltc_check_in_datetime__c | timeEst:$endTime }}
                        </div>
                      </div></mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
              </mat-table>
        </mat-card-content>
      </mat-card>
    </div>
  </ion-content>